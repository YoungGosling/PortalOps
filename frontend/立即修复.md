# ğŸš¨ ç«‹å³ä¿®å¤ - Cookie åŒæ­¥é—®é¢˜

## é—®é¢˜åŸå› 

æ‰¾åˆ°äº†ï¼Token åœ¨ localStorage ä¸­ï¼Œä½† **middleware éœ€è¦ cookie**ï¼

## ä¿®å¤å®Œæˆ âœ…

å·²ä¿®æ”¹ `providers/auth-provider.tsx`ï¼Œç°åœ¨æ‰€æœ‰ token è®¾ç½®éƒ½**åŒæ—¶è®¾ç½® cookie**ã€‚

## ğŸš€ ç«‹å³æµ‹è¯•ï¼ˆ5 åˆ†é’Ÿï¼‰

### æ­¥éª¤ 1: æ¸…é™¤æ•°æ®ï¼ˆå¿…é¡»ï¼ï¼‰

**åœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼ˆæŒ‰ F12ï¼‰æ‰§è¡Œï¼š**

```javascript
localStorage.clear()
sessionStorage.clear()
document.cookie.split(";").forEach(c => {
  document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
})
alert('æ¸…é™¤å®Œæˆï¼ç‚¹å‡»ç¡®å®šåé¡µé¢å°†åˆ·æ–°')
location.reload()
```

### æ­¥éª¤ 2: ç™»å½•

è®¿é—® http://localhost:3000/signin

ä½¿ç”¨ï¼š
- é‚®ç®±: `admin@portalops.com`
- å¯†ç : `password`

### æ­¥éª¤ 3: éªŒè¯ï¼ˆå…³é”®ï¼ï¼‰

ç™»å½•æˆåŠŸåï¼Œ**ç«‹å³åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š**

```javascript
console.log('Token:', localStorage.getItem('portalops_token') ? 'âœ…' : 'âŒ')
console.log('Cookie:', document.cookie.includes('auth_token') ? 'âœ…' : 'âŒ')
```

**å¿…é¡»ä¸¤ä¸ªéƒ½æ˜¯ âœ…ï¼**

å¦‚æœ Cookie æ˜¯ âŒï¼Œè¯´æ˜ï¼š
1. ä»£ç æœªä¿å­˜ï¼Œæˆ–
2. éœ€è¦é‡å¯å‰ç«¯æœåŠ¡

### æ­¥éª¤ 4: è®¿é—®é¡µé¢

è®¿é—® http://localhost:3000/services

**åº”è¯¥çœ‹åˆ°ï¼š**
- âœ… é¡µé¢æœ‰æ•°æ®
- âœ… ä¸å†æœ‰ 403 é”™è¯¯
- âœ… æ§åˆ¶å°æ˜¾ç¤º `Status: 200`

## å¦‚æœ Cookie æ£€æŸ¥æ˜¯ âŒ

### é‡å¯å‰ç«¯æœåŠ¡

```bash
# åœ¨ç»ˆç«¯æŒ‰ Ctrl+C åœæ­¢
# ç„¶åæ‰§è¡Œï¼š
cd frontend
pnpm dev
```

### ç„¶åé‡æ–°æµ‹è¯•

ä»"æ­¥éª¤ 1: æ¸…é™¤æ•°æ®"é‡æ–°å¼€å§‹ã€‚

## æˆåŠŸæ ‡å¿—

âœ… **æ‰€æœ‰è¿™äº›éƒ½åº”è¯¥æ˜¯ trueï¼š**

```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œ
console.log({
  'localStorageæœ‰token': !!localStorage.getItem('portalops_token'),
  'localStorageæœ‰user': !!localStorage.getItem('portalops_user'),
  'cookieæœ‰auth_token': document.cookie.includes('auth_token'),
  'é¡µé¢æœ‰æ•°æ®': 'æ£€æŸ¥é¡µé¢æ˜¯å¦æ˜¾ç¤ºå†…å®¹'
})
```

## åŸç†

```
ç™»å½•æˆåŠŸ
  â†“
è®¾ç½® localStorage.portalops_token  âœ…
  â†“
è®¾ç½® cookie.auth_token             âœ… (æ–°å¢ï¼)
  â†“
Middleware æ£€æŸ¥ cookie             âœ… é€šè¿‡
  â†“
å…è®¸è®¿é—®é¡µé¢                        âœ…
  â†“
API è¯·æ±‚ä½¿ç”¨ localStorage token   âœ…
  â†“
è¿”å› 200                           âœ…
```

## éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœä»ç„¶å¤±è´¥ï¼Œè¯·æä¾›ï¼š

```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œå¹¶æˆªå›¾
console.log('=== è°ƒè¯•ä¿¡æ¯ ===')
console.log('Token:', localStorage.getItem('portalops_token')?.substring(0, 50))
console.log('User:', localStorage.getItem('portalops_user'))
console.log('Cookies:', document.cookie)
```

---

**å…³é”®ï¼š** å¿…é¡»ç¡®ä¿ Cookie ä¸­æœ‰ `auth_token`ï¼

